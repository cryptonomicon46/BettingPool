
const BettingPool = artifacts.require("./BettingPool")


const { assert, expect, should, Assertion } = require('chai')
const { BN, expectRevert, time } = require('@openzeppelin/test-helpers');
const { web3 } = require('@openzeppelin/test-helpers/src/setup');



require('chai')
    .use(require('chai-as-promised'))
    .should()

const EVM_REVERT = 'VM Exception while processing transaction: revert'
const ids =[46,93,99,27]; 

// 24*3600*4
const  maxAmounts = [50,25,25,25];


    const d = new Date();
        const nftInfo = ["46,50",
            "93,25",
            "99,25",
            "27,25"]


    const bettingStop = 345600000;//24*3600*4*1000; //4 days

    const c1_reveal= Date.parse("Sun, June 19, 2022 11:59:59"); //1655665199000
    const c1_endBet = c1_reveal - bettingStop; //1655319599000



    const c2_reveal= Date.parse("Sun, July 10, 2022 11:59:59"); //1657479599000
    const c2_endBet = c2_reveal - bettingStop;//1657133999000
    
    const c3_reveal= Date.parse("Mon, August 14, 2022 11:59:59"); //1660503599000
    const c3_endBet = c3_reveal - bettingStop;//1660157999000
    
    let _tokenURI=  "https://ipfs.io/ipfs/QmcDRWwXCE1LjvdESNZsmc75syTJP2zA8WW9SHEaCwEmkc/{id}.json";
    var tokenURI;
    let newTokenURI = "NewTokenURI{id}.json";
    let base_ext = ".json";
    
    const DURATION = 200;//SECONDS



contract('Betting Pool and Mint', async (accounts) => {
    const deployer = accounts[0]
    const devAddress = accounts[1]
    const sender1 = accounts[2]
    const unauthorized = accounts[3]
    const sender2 = accounts[4]
    const sender3 = accounts[5]


     console.log("Deployer Addr:",deployer)
     console.log("Developer Addr:",devAddress)
     console.log("Unauthorized Addr:",unauthorized)
     console.log("Sender1 Addr:",sender1)



    describe('Deployment', () => {

        // let milliseconds = 120000 // Number between 100000 - 999999
        let result, timeDeployed

        beforeEach(async () => {

            bettingPool = await BettingPool.new(
                ids,
                // prices,
                maxAmounts
            )
            await bettingPool.setAddresses(devAddress,{from: deployer});

            // timeDeployed = NFT_MINT_DATE - Number(milliseconds.toString().slice(0, 3))
        })

        it('Returns the contract owner', async () => {
            result = await bettingPool.owner()
            assert.equal(result,deployer)
        })
    

        it('Only owner can set the developer address', async () => {

            await expect(bettingPool.setAddresses
                (devAddress,{from: unauthorized})).to.be.rejected;    

            await bettingPool.setAddresses(sender1,{from: deployer})
            result = await bettingPool.getAddresses({from:deployer})
            console.log("New Developer Addr",result.toString())

        })




        it('Check NFT Info per tokenID', async () => {
            for(let i =0; i< ids.length; i++) {
            result = await bettingPool.getNFTInfo(ids[i])
            // console.log(result.toString())
            expect(result.toString()).to.equal(nftInfo[i]);

            }
        })


        it('Test if the URI function returns the correct per token URI', async () => {
            for(let i =0; i< ids.length; i++) {
            result = await bettingPool.uri(ids[i]);
            tokenURI = _tokenURI.replace("{id}",ids[i].toString());
            // console.log(`${result}, ${tokenURI}`);
            expect(result).to.equal(tokenURI.replace("{id}",ids[i].toString()));
        }
        })



        it("Test to confirm that TokenURI can be changed by owner if needed.", async() => {

            for (let i=0;i< ids.length; i++) {
                await bettingPool.setTokenURI(newTokenURI.slice(0,11),ids[i].toString(), {from: deployer});
                result = await bettingPool.uri(ids[i].toString())
                expect(result).to.equal(newTokenURI.slice(0,11).concat(ids[i].toString().concat(".json")))
            }
        })


     
    })


    describe('Start betting campaigns and test related functions.', () => {

        // let milliseconds = 120000 // Number between 100000 - 999999
        let result, timeDeployed

        // const d4 = new Date("June 19, 2022 11:59:59");//1655665199000
        //d4.getDate()
        // d4.getTime()
        // d4.getDay()  Sunday= 0,...Sat = 6
        // const bettingStop = 4*24*3600*1000;

      

        beforeEach(async () => {

            bettingPool = await BettingPool.new(
                ids,
                maxAmounts
            )
            await bettingPool.setAddresses(devAddress,{from: deployer});

            // timeDeployed = NFT_MINT_DATE - Number(milliseconds.toString().slice(0, 3))
        })



        // it("Only owner can start a new campaign", async () =>{
        //     await expect(bettingPool.setCampaign("0",'1',c0_reveal,c0_endBet,
        //     {from: unauthorized})).to.be.rejected;
        // })

        it('Check campaign stages.', async () => {
           
        
        await bettingPool.setCampaign(0,1,c1_endBet/1000,{from: deployer})
        await bettingPool.setCampaign(0,2,c2_endBet/1000,{from: deployer})
        await bettingPool.setCampaign(0,3,c3_endBet/1000,{from: deployer})
        await bettingPool.setAddresses(devAddress,{from: deployer});
        timeDeployed = Math.round(d.getTime()/1000);//time in seconds
        console.log('StartTime:',timeDeployed);
            
        //Check number of campaigns
            result = await bettingPool.getNumCampaigns({from:deployer})
            assert.equal(result.toString(),'3')


            //Check the stage of the campaigns and make they're accepting bets accepting bets
            // 0: AcceptingBets
            // 1: BettingStopped
            // 2. Reveal Winner
            result = await bettingPool.getCampaignStage(1,{from: deployer})
            assert.equal(result.toString(),'0')

            result = await bettingPool.getCampaignStage(2,{from: deployer})
            assert.equal(result.toString(),'0')


            result = await bettingPool.getCampaignStage(3,{from: deployer})
            assert.equal(result.toString(),'0')

        
       
        

        })

        it('Check Reveal and betting stop dates.', async () => {
            await bettingPool.setCampaign(0,1,c1_endBet/1000,{from: deployer})
            await bettingPool.setCampaign(0,2,c2_endBet/1000,{from: deployer})
            await bettingPool.setCampaign(0,3,c3_endBet/1000,{from: deployer})
            await bettingPool.setAddresses(devAddress,{from: deployer});
            //Check number of campaigns
            result = await bettingPool.getNumCampaigns({from:deployer})
            assert.equal(result.toString(),'3')


            //Check the stage of the campaigns and make they're accepting bets accepting bets
            // 0: AcceptingBets
            // 1: BettingStopped
            // 2. Reveal Winner
            result = await bettingPool.getCampaignStage(1,{from: deployer})
            assert.equal(result.toString(),'0')

            result = await bettingPool.getCampaignStage(2,{from: deployer})
            assert.equal(result.toString(),'0')


            result = await bettingPool.getCampaignStage(3,{from: deployer})
            assert.equal(result.toString(),'0')

        
       
            //Confirm the start and end times
            result = await bettingPool.getCampaignInfo(1,{from: deployer})
            // console.log('Campaign1 Reveal Date:',result[3].toString());
            // console.log('Campaign1 Stop Bet Date:',result[2].toString());
            assert.equal((c1_endBet/1000).toString(),result[2].toString())
            assert.equal((c1_reveal/1000).toString(),result[3].toString())

            result = await bettingPool.getCampaignInfo(2,{from: deployer})
            // console.log('Campaign2 Reveal Date:',result[3].toString());
            // console.log('Campaign2 Stop Bet Date:',result[2].toString());
            assert.equal((c2_endBet/1000).toString(),result[2].toString())
            assert.equal((c2_reveal/1000).toString(),result[3].toString())

            result = await bettingPool.getCampaignInfo(3,{from: deployer})
            // console.log('Campaign3 Reveal Date:',result[3].toString());
            // console.log('Campaign3 Stop Bet Date:',result[2].toString());
            assert.equal((c3_endBet/1000).toString(),result[2].toString())
            assert.equal((c3_reveal/1000).toString(),result[3].toString())

        })


    
    })

    describe('Set a betting campaign and do the various checks', () => {

        // let milliseconds = 120000 // Number between 100000 - 999999
        let result, timeDeployed


        beforeEach(async () => {

        bettingPool = await BettingPool.new(
            ids,
            maxAmounts
        )
        await bettingPool.setAddresses(devAddress,{from: deployer});
        await bettingPool.setCampaign(0,1,(c1_endBet/1000),{from: deployer})
            // timeDeployed = NFT_MINT_DATE - Number(milliseconds.toString().slice(0, 3))
    })




    it("Accept bets and check number of betters and campaign balance.", async() => { 


        let stopBetDuration = time.duration.seconds(604800); //7 days from Friday
        let revealBetDuration = time.duration.seconds(3456000); //4 days

        startTime = await bettingPool.currentBlockStamp({from: deployer})
        // console.log('CurrentBlockTimeStamp:',startTime.toString());

        //Advance to stop time
        const stopTime_BN = web3.utils.toBN(startTime).add(stopBetDuration)
        // console.log('StopBet Timestamp:',stopTime_BN.toString());

        await bettingPool.setCampaign(0,2,stopTime_BN,{from: deployer})
         await bettingPool.bet(2,46,{from:sender1, value: web3.utils.toWei('0.5')}) //Winner
        await bettingPool.bet(2,46,{from:sender2, value: web3.utils.toWei('0.3')})
        await bettingPool.bet(2,46,{from:sender3, value: web3.utils.toWei('0.2')})

        result = await bettingPool.getCampaignInfo(2,{from:deployer})
        assert.equal(result[5].toString(),'3') //stage
        assert.equal(result[6].toString(),web3.utils.toWei('1')) //totalAmount

    })


    it("Accept bets and reveal the campaign winner.", async() => { 
        let stopBetDuration = time.duration.seconds(604800); //7 days from Friday
        let revealBetDuration = time.duration.seconds(345600); //4 days

        startTime = await bettingPool.currentBlockStamp({from: deployer})
        // console.log('CurrentBlockTimeStamp:',startTime.toString());

        //Advance to stop time
        const stopTime_BN = web3.utils.toBN(startTime).add(stopBetDuration)
        // console.log('StopBet Timestamp:',stopTime_BN.toString());

        await bettingPool.setCampaign(0,2,stopTime_BN,{from: deployer})
         await bettingPool.bet(2,46,{from:sender1, value: web3.utils.toWei('0.5')}) //Winner
        await bettingPool.bet(2,46,{from:sender2, value: web3.utils.toWei('0.3')})
        await bettingPool.bet(2,46,{from:sender3, value: web3.utils.toWei('0.2')})

        result = await bettingPool.getCampaignInfo(2,{from:deployer})
        assert.equal(result[5].toString(),'3') //stage
        assert.equal(result[6].toString(),web3.utils.toWei('1')) //totalAmount

        await time.increase(stopBetDuration);

        //Make sure accounts cant bet after the stop time. 
        await expect(bettingPool.bet(2,27,{from:sender1, value: web3.utils.toWei('0.5')})).to.be.rejected;

        // result = await bettingPool.currentBlockStamp({from: deployer})
        // assert.equal(result.toString(),stopTime_BN.toString())
        // expect(web3.utils.toBN(result)).to.be.within(stopTime_BN.add('5')),stopTime_BN.add('10');


        //Check if the stage = 1 after the stop time
        await bettingPool.changeStage(2,{from:deployer})
        // result = await bettingPool.getCampaignInfo(2,{from: deployer})
        // console.log('Campaign stage after stop',result[4].toString())
        // assert(result[4].toString(),'1')

        result = await bettingPool.getCampaignStage(2,{from:deployer})
        // console.log(`Campaign stage after closing bets ${result.toString()}`)
        assert(result.toString().toString(),'1')


        //Advance blocktimestamp to reveal stage
        //Check if the campaign stage = 2
        result = await bettingPool.currentBlockStamp({from: deployer})
        const revealTime_BN = web3.utils.toBN(result).add(revealBetDuration)
        await time.increase(revealTime_BN);


        await bettingPool.changeStage(2,{from:deployer}) //Prompt a stage transition

        result = await bettingPool.getCampaignStage(2,{from:deployer})
        // console.log(`Campaign stage after reveal bets ${result.toString()}`)
        assert(result.toString().toString(),'2')


        // result = await bettingPool.getCampaignInfo(2,{from: deployer})
        // console.log('Campaign winner reveal time',result[4].toString())
        // assert(result[4].toString(),'2')


        //Reveal Winners for Campaign#2 for winning racer #46
                // result = await bettingPool.getWinner(2)

        // console.log(result[0].toString())
        // console.log(`Winner Address: ${result[0].toString()}`)
        // console.log(`Winner Amount: ${result[1].toString()}`)
        // assert.equal(result[0].toString(),sender1)
        // assert.equal(result[1].toString(),web3.utils.toWei('0.95'))


        //Get Winner for campaign#2 for winning racer #46
        await bettingPool.revealWinner(2,46,{from: deployer})

        result = await bettingPool.getWinner(2)
        // console.log(`Winner Address: ${result[0].toString()}`)
        // console.log(`Winner Amount: ${result[1].toString()}`)
        assert.equal(result[0].toString(),sender1)
        assert.equal(result[1].toString(),web3.utils.toWei('0.95'))

        //Check pending withdrawal for winner
        result = await bettingPool.pendingWithdrawal(sender1);
        // console.log(`Pending withdrawal for sender ${result.toString()}`)
        assert.equal(result.toString(),web3.utils.toWei('0.95'))

        //Check pending withdrawal for the Developer 
        result = await bettingPool.pendingWithdrawal(devAddress);
        // console.log(`Pending withdrawal for sender ${result.toString()}`)
        assert.equal(result.toString(),web3.utils.toWei('0.05'))

        //Check if an NFT was minted to the winner of the campaign#2 for racer#46
        result = await bettingPool.balanceOf(sender1,46,{from: sender1});
        assert.equal(result.toString(),'1')

        result = await bettingPool.balanceOf(sender2,46,{from: sender1});
        assert.equal(result.toString(),'0')
        result = await bettingPool.balanceOf(sender3,46,{from: sender1});
        assert.equal(result.toString(),'0')
     

    })



        
    })
 
})


//Compiled byte code
// 0x6080604052600436106101f4576000357c0100000000000000000000000000000000000000000000000000000000900480637ae4bff81161011f578063d188929f116100b2578063e985e9c511610081578063e985e9c514610617578063f21f537d14610660578063f242432a14610694578063f6a6b422146106b457600080fd5b8063d188929f14610581578063d9a9bb3e146105bc578063df13d7ad146105d1578063e38e2b82146105e457600080fd5b8063975b97fe116100ee578063975b97fe146104fc578063a22cb4651461052c578063a39fac121461054c578063a95f77941461056157600080fd5b80637ae4bff81461045457806381d3c435146104745780638276d314146104945780638da5cb5b146104c457600080fd5b80633ccfd60b116101975780634f617677116101665780634f61767714610396578063520a5b0a146104015780636ffcc719146104215780637134e71e1461043457600080fd5b80633ccfd60b1461030d5780634129b2c9146103155780634dd74aac146103545780634e1273f41461036957600080fd5b806309a3beef116101d357806309a3beef146102895780630e89341c146102ab578063125d7020146102d85780632eb2c2d6146102ed57600080fd5b8062fdd58e146101f957806301ffc9a71461022c5780630964c95b1461025c575b600080fd5b34801561020557600080fd5b50610219610214366004612847565b6106d4565b6040519081526020015b60405180910390f35b34801561023857600080fd5b5061024c610247366004612889565b610780565b6040519015158152602001610223565b34801561026857600080fd5b506102196102773660046128a6565b60126020526000908152604090205481565b34801561029557600080fd5b506102a96102a4366004612967565b61081d565b005b3480156102b757600080fd5b506102cb6102c63660046129c0565b6108e6565b6040516102239190612a31565b3480156102e457600080fd5b506102196109f5565b3480156102f957600080fd5b506102a9610308366004612af6565b610a57565b6102a9610afc565b34801561032157600080fd5b506103356103303660046129c0565b610cde565b60408051600160a060020a039093168352602083019190915201610223565b34801561036057600080fd5b50610219610d8b565b34801561037557600080fd5b50610389610384366004612ba4565b610dc3565b6040516102239190612ca9565b3480156103a257600080fd5b506103dc6103b13660046129c0565b600b60205260009081526040902080546001820154600290920154600160a060020a03909116919083565b60408051600160a060020a039094168452602084019290925290820152606001610223565b34801561040d57600080fd5b5061021961041c366004612cbc565b610f04565b6102a961042f366004612cbc565b610f58565b34801561044057600080fd5b506102a961044f366004612cde565b611226565b34801561046057600080fd5b5061021961046f3660046129c0565b611332565b34801561048057600080fd5b506102a961048f3660046128a6565b611419565b3480156104a057600080fd5b506102196104af3660046129c0565b60009081526015602052604090206003015490565b3480156104d057600080fd5b506006546104e490600160a060020a031681565b604051600160a060020a039091168152602001610223565b34801561050857600080fd5b506102196105173660046129c0565b60009081526015602052604090206004015490565b34801561053857600080fd5b506102a9610547366004612d29565b6114a2565b34801561055857600080fd5b506104e46114b1565b34801561056d57600080fd5b5061021961057c3660046129c0565b6114f3565b34801561058d57600080fd5b506105a161059c3660046129c0565b61154b565b60408051825181526020928301519281019290925201610223565b3480156105c857600080fd5b50610219611624565b6102a96105df366004612cbc565b611664565b3480156105f057600080fd5b506106046105ff3660046129c0565b611a9c565b6040516102239796959493929190612da1565b34801561062357600080fd5b5061024c610632366004612ded565b600160a060020a03918216600090815260016020908152604080832093909416825291909152205460ff1690565b34801561066c57600080fd5b506102197f0000000000000000000000000000000000000000000000000000000062a35db181565b3480156106a057600080fd5b506102a96106af366004612e1b565b611b60565b3480156106c057600080fd5b506102a96106cf366004612cbc565b611bfe565b6000600160a060020a03831661075a5760405160e560020a62461bcd02815260206004820152602b60248201527f455243313135353a2062616c616e636520717565727920666f7220746865207a60448201527f65726f206164647265737300000000000000000000000000000000000000000060648201526084015b60405180910390fd5b50600090815260208181526040808320600160a060020a03949094168352929052205490565b6000600160e060020a031982167fd9b67a260000000000000000000000000000000000000000000000000000000014806107e35750600160e060020a031982167f0e89341c00000000000000000000000000000000000000000000000000000000145b8061081757507f01ffc9a700000000000000000000000000000000000000000000000000000000600160e060020a03198316145b92915050565b600654600160a060020a031633811461084b5760405160e860020a6282b42902815260040160405180910390fd5b8261085583611c7c565b600460405160200161086993929190612ebb565b60408051601f1981840301815291815260008481526011602090815291902082516108999391929091019061279f565b506000828152601160205260409081902090517faa9103d5d6eea4f6c7e86c99d53cf3a0a3f1fc853a138aa8117c61ec695bf526916108d9918590612f57565b60405180910390a1505050565b600081815260116020526040902080546060919061090390612e84565b90506000036109575760405160e560020a62461bcd02815260206004820152601960248201527f5468697320746f6b656e20646f65736e277420657869737421000000000000006044820152606401610751565b6000828152601160205260409020805461097090612e84565b80601f016020809104026020016040519081016040528092919081815260200182805461099c90612e84565b80156109e95780601f106109be576101008083540402835291602001916109e9565b820191906000526020600020905b8154815290600101906020018083116109cc57829003601f168201915b50505050509050919050565b600654600090600160a060020a0316338114610a265760405160e860020a6282b42902815260040160405180910390fd5b610a507f0000000000000000000000000000000000000000000000000000000062a35db142612ffe565b91505b5090565b600160a060020a038516331480610a735750610a738533610632565b610ae85760405160e560020a62461bcd02815260206004820152603260248201527f455243313135353a207472616e736665722063616c6c6572206973206e6f742060448201527f6f776e6572206e6f7220617070726f76656400000000000000000000000000006064820152608401610751565b610af58585858585611dd8565b5050505050565b60165460ff1615610b525760405160e560020a62461bcd02815260206004820152600e60248201527f5265656e7472616e742043616c6c0000000000000000000000000000000000006044820152606401610751565b6016805460ff1916600117905533600081815260126020526040808220805490839055905190929083908381818185875af1925050503d8060008114610bb4576040519150601f19603f3d011682016040523d82523d6000602084013e610bb9565b606091505b5050905080610bdd5760405160e560020a62461bcd02815260040161075190613015565b60408051338152602081018490527f5dba113b49cfa7c90315e8e604e6b506f7abcb909b01dcb19ec39005086e68fc910160405180910390a150506016805460ff1916905533600081815260126020526040808220805490839055905190929083908381818185875af1925050503d8060008114610c77576040519150601f19603f3d011682016040523d82523d6000602084013e610c7c565b606091505b5050905080610ca05760405160e560020a62461bcd02815260040161075190613015565b60408051338152602081018490527f5dba113b49cfa7c90315e8e604e6b506f7abcb909b01dcb19ec39005086e68fc91015b60405180910390a15050565b6000808260026000610cfb83600090815260156020526040902090565b9050816002811115610d0f57610d0f612d67565b60028083015460ff1690811115610d2857610d28612d67565b14610d5f576040517fa264a95400000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b50505060009283525050601560205260409020600c810154600b90910154600160a060020a0390911691565b600654600090600160a060020a0316338114610dbc5760405160e860020a6282b42902815260040160405180910390fd5b4291505090565b60608151835114610e3f5760405160e560020a62461bcd02815260206004820152602960248201527f455243313135353a206163636f756e747320616e6420696473206c656e67746860448201527f206d69736d6174636800000000000000000000000000000000000000000000006064820152608401610751565b6000835167ffffffffffffffff811115610e5b57610e5b6128c3565b604051908082528060200260200182016040528015610e84578160200160208202803683370190505b50905060005b8451811015610efc57610ecf858281518110610ea857610ea8613072565b6020026020010151858381518110610ec257610ec2613072565b60200260200101516106d4565b828281518110610ee157610ee1613072565b6020908102919091010152610ef58161308b565b9050610e8a565b509392505050565b600654600090600160a060020a0316338114610f355760405160e860020a6282b42902815260040160405180910390fd5b505060009182526015602090815260408084209284526008909201905290205490565b6000828152601560205260408120839150600060028083015460ff1690811115610f8457610f84612d67565b148015610f95575080600301544210155b15610faa5760028101805460ff191660011790555b600160028083015460ff1690811115610fc557610fc5612d67565b148015610fd6575080600401544210155b15610fec576002818101805460ff191690911790555b8360008061100583600090815260156020526040902090565b905081600281111561101957611019612d67565b60028083015460ff169081111561103257611032612d67565b14611069576040517fa264a95400000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600654600160a060020a0316331480159061108f5750600754600160a060020a03163314155b6111045760405160e560020a62461bcd02815260206004820152602960248201527f4f776e657220616e6420646576732063616e6e6f7420626964206f6e2074686960448201527f732061756374696f6e00000000000000000000000000000000000000000000006064820152608401610751565b6000871161113e576040517fa857911300000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600087815260156020526040812060008881526008820160209081526040808320815160608101835233808252348286019081524283860190815284546001808201875595895287892094516003909102909401805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a03909516949094178455905183850155516002909201919091558c85526005860184528285209085529092528220805460ff19169091179055600682018054929350906111fe8361308b565b91905055503481600701600082825461121791906130a4565b90915550505050505050505050565b600654600160a060020a03163381146112545760405160e860020a6282b42902815260040160405180910390fd5b60008360ff16116112aa5760405160e560020a62461bcd02815260206004820152601360248201527f496e76616c69642052616365204e756d626572000000000000000000000000006044820152606401610751565b60088054600091826112bb8361308b565b9091555060008181526015602052604090208054919250908690829060ff191660018360028111156112ef576112ef612d67565b0217905550805461ff00191661010060ff8716021781556003810184905561131b8463149970006130a4565b6004820155600201805460ff191690555050505050565b600654600090600160a060020a03163381146113635760405160e860020a6282b42902815260040160405180910390fd5b60008381526015602052604081209050600060028083015460ff169081111561138e5761138e612d67565b14801561139f575080600301544210155b156113b45760028101805460ff191660011790555b600160028083015460ff16908111156113cf576113cf612d67565b1480156113e0575080600401544210155b156113f6576002818101805460ff191690911790555b60028082015460ff169081111561140f5761140f612d67565b9250505b50919050565b600654600160a060020a03163381146114475760405160e860020a6282b42902815260040160405180910390fd5b6007805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0384169081179091556040519081527f292c0d8d8c63a0a0a42cc1103baf921b3f13ea455e3298dbcf67e3edba8a6a3890602001610cd2565b6114ad338383611fd3565b5050565b600654600090600160a060020a03163381146114e25760405160e860020a6282b42902815260040160405180910390fd5b5050600754600160a060020a031690565b600654600090600160a060020a03163381146115245760405160e860020a6282b42902815260040160405180910390fd5b600083815260156020526040902060028082015460ff169081111561140f5761140f612d67565b60408051808201909152600080825260208201526000828152601160205260409020805461157890612e84565b90506000036115cc5760405160e560020a62461bcd02815260206004820152601960248201527f5468697320746f6b656e20646f65736e277420657869737421000000000000006044820152606401610751565b6000828152600e602052604090205460098054829081106115ef576115ef613072565b906000526020600020906002020160405180604001604052908160008201548152602001600182015481525050915050919050565b600654600090600160a060020a03163381146116555760405160e860020a6282b42902815260040160405180910390fd5b6001600854610a509190612ffe565b6000828152601560205260408120839150600060028083015460ff169081111561169057611690612d67565b1480156116a1575080600301544210155b156116b65760028101805460ff191660011790555b600160028083015460ff16908111156116d1576116d1612d67565b1480156116e2575080600401544210155b156116f8576002818101805460ff191690911790555b600084815260156020526040902084906002908160028083015460ff169081111561172557611725612d67565b1461175c576040517fa264a95400000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600654600160a060020a031633811461178a5760405160e860020a6282b42902815260040160405180910390fd5b60008881526015602090815260408083206007810154600982015581516060808201845285825281850186905281840186905283519081018452858152938401859052918301939093529060008a8152600884016020526040812080549091906117f6576117f6613072565b60009182526020808320600390920290910154600160a060020a031683528b825260088501905260408120805490919061183257611832613072565b6000918252602080832060016003909302019190910154838201528b825260088501905260408120805490919061186b5761186b613072565b6000918252602090912060026003909202010154604082015260015b60008b81526008850160205260409020548110156119e05760008b815260088501602052604090208054829081106118c1576118c1613072565b60009182526020808320600390920290910154600160a060020a031685528c8252600886019052604090208054829081106118fe576118fe613072565b6000918252602080832060016003909302019190910154858201528c82526008860190526040902080548290811061193857611938613072565b906000526020600020906003020160020154836040018181525050816020015183602001511115611989578251600160a060020a0316825260208084015190830152604080840151908301526119ce565b816020015183602001511480156119a7575081604001518360400151105b156119ce578251600160a060020a0316825260208084015190830152604080840151908301525b806119d88161308b565b915050611887565b508051600c8401805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0383161790556040820151600d850155611a22908b906120ca565b6005546009840154611a4091606491611a3a9161216a565b9061217d565b600a84018190556009840154611a5591612189565b600b8401908155600a90930154600754600160a060020a03908116600090815260126020526040808220939093559454925116845290922091909155505050505050505050565b600654600090819081908190819081908190600160a060020a0316338114611ad95760405160e860020a6282b42902815260040160405180910390fd5b60008911611b13576040517fa857911300000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b505050600095865250506015602052505060409091208054600382015460048301546002840154600685015460079095015460ff8086169861010090960481169750939592949390911692565b600160a060020a038516331480611b7c5750611b7c8533610632565b611bf15760405160e560020a62461bcd02815260206004820152602960248201527f455243313135353a2063616c6c6572206973206e6f74206f776e6572206e6f7260448201527f20617070726f76656400000000000000000000000000000000000000000000006064820152608401610751565b610af58585858585612195565b600654600160a060020a0316338114611c2c5760405160e860020a6282b42902815260040160405180910390fd5b6000838152601560205260409020826002811115611c4c57611c4c612d67565b8160020160006101000a81548160ff02191690836002811115611c7157611c71612d67565b021790555050505050565b606081600003611cbf57505060408051808201909152600181527f3000000000000000000000000000000000000000000000000000000000000000602082015290565b8160005b8115611ce95780611cd38161308b565b9150611ce29050600a836130d5565b9150611cc3565b60008167ffffffffffffffff811115611d0457611d046128c3565b6040519080825280601f01601f191660200182016040528015611d2e576020820181803683370190505b5090505b8415611dd057611d43600183612ffe565b9150611d50600a866130e9565b611d5b9060306130a4565b7f010000000000000000000000000000000000000000000000000000000000000002818381518110611d8f57611d8f613072565b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350611dc9600a866130d5565b9450611d32565b949350505050565b8151835114611e525760405160e560020a62461bcd02815260206004820152602860248201527f455243313135353a2069647320616e6420616d6f756e7473206c656e6774682060448201527f6d69736d617463680000000000000000000000000000000000000000000000006064820152608401610751565b600160a060020a038416611e7b5760405160e560020a62461bcd028152600401610751906130fd565b3360005b8451811015611f65576000858281518110611e9c57611e9c613072565b602002602001015190506000858381518110611eba57611eba613072565b60209081029190910181015160008481528083526040808220600160a060020a038e168352909352919091205490915081811015611f0d5760405160e560020a62461bcd0281526004016107519061315a565b600083815260208181526040808320600160a060020a038e8116855292528083208585039055908b16825281208054849290611f4a9084906130a4565b9250508190555050505080611f5e9061308b565b9050611e7f565b5084600160a060020a031686600160a060020a031682600160a060020a03167f4a39dc06d4c0dbc64b70af90fd698a233a518aa5d07e595d983b8c0526c8f7fb8787604051611fb59291906131b7565b60405180910390a4611fcb8187878787876122c5565b505050505050565b81600160a060020a031683600160a060020a03160361205d5760405160e560020a62461bcd02815260206004820152602960248201527f455243313135353a2073657474696e6720617070726f76616c2073746174757360448201527f20666f722073656c6600000000000000000000000000000000000000000000006064820152608401610751565b600160a060020a03838116600081815260016020908152604080832094871680845294825291829020805460ff191686151590811790915591519182527f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31910160405180910390a3505050565b33612101576040517fe6c4247b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000828152600e6020526040812054600980549192918390811061212757612127613072565b6000918252602090912060016002909202010154905061214882600161246d565b612164838560016040518060200160405280600081525061253a565b50505050565b600061217682846131e5565b9392505050565b600061217682846130d5565b60006121768284612ffe565b600160a060020a0384166121be5760405160e560020a62461bcd028152600401610751906130fd565b3360006121ca85612664565b905060006121d785612664565b9050600086815260208181526040808320600160a060020a038c1684529091529020548581101561221d5760405160e560020a62461bcd0281526004016107519061315a565b600087815260208181526040808320600160a060020a038d8116855292528083208985039055908a1682528120805488929061225a9084906130a4565b90915550506040805188815260208101889052600160a060020a03808b16928c821692918816917fc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62910160405180910390a46122ba848a8a8a8a8a6126af565b505050505050505050565b600160a060020a0384163b15611fcb576040517fbc197c81000000000000000000000000000000000000000000000000000000008152600160a060020a0385169063bc197c81906123229089908990889088908890600401613204565b6020604051808303816000875af192505050801561235d575060408051601f3d908101601f1916820190925261235a91810190613262565b60015b6124185761236961327f565b806308c379a0036123a5575061237d6132b8565b8061238857506123a7565b8060405160e560020a62461bcd0281526004016107519190612a31565b505b60405160e560020a62461bcd02815260206004820152603460248201527f455243313135353a207472616e7366657220746f206e6f6e204552433131353560448201527f526563656976657220696d706c656d656e7465720000000000000000000000006064820152608401610751565b600160e060020a031981167fbc197c8100000000000000000000000000000000000000000000000000000000146124645760405160e560020a62461bcd02815260040161075190613342565b50505050505050565b806009838154811061248157612481613072565b90600052602060002090600202016001015410156124cb576040517fdec32ed000000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b80600983815481106124df576124df613072565b906000526020600020906002020160010160008282546124ff9190612ffe565b909155505060408051838152602081018390527f7517bbe60f7c67f45055242fdee9b505e18c8822d32012fe33c18e5439cee1f29101610cd2565b600160a060020a0384166125b95760405160e560020a62461bcd02815260206004820152602160248201527f455243313135353a206d696e7420746f20746865207a65726f2061646472657360448201527f73000000000000000000000000000000000000000000000000000000000000006064820152608401610751565b3360006125c585612664565b905060006125d285612664565b9050600086815260208181526040808320600160a060020a038b168452909152812080548792906126049084906130a4565b90915550506040805187815260208101879052600160a060020a03808a1692600092918716917fc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62910160405180910390a4612464836000898989896126af565b6040805160018082528183019092526060916000919060208083019080368337019050509050828160008151811061269e5761269e613072565b602090810291909101015292915050565b600160a060020a0384163b15611fcb576040517ff23a6e61000000000000000000000000000000000000000000000000000000008152600160a060020a0385169063f23a6e619061270c908990899088908890889060040161339f565b6020604051808303816000875af1925050508015612747575060408051601f3d908101601f1916820190925261274491810190613262565b60015b6127535761236961327f565b600160e060020a031981167ff23a6e6100000000000000000000000000000000000000000000000000000000146124645760405160e560020a62461bcd02815260040161075190613342565b8280546127ab90612e84565b90600052602060002090601f0160209004810192826127cd5760008555612813565b82601f106127e657805160ff1916838001178555612813565b82800160010185558215612813579182015b828111156128135782518255916020019190600101906127f8565b50610a539291505b80821115610a53576000815560010161281b565b600160a060020a038116811461284457600080fd5b50565b6000806040838503121561285a57600080fd5b82356128658161282f565b946020939093013593505050565b600160e060020a03198116811461284457600080fd5b60006020828403121561289b57600080fd5b813561217681612873565b6000602082840312156128b857600080fd5b81356121768161282f565b60e060020a634e487b7102600052604160045260246000fd5b601f8201601f1916810167ffffffffffffffff81118282101715612902576129026128c3565b6040525050565b600067ffffffffffffffff831115612923576129236128c3565b60405161293a601f8501601f1916602001826128dc565b80915083815284848401111561294f57600080fd5b83836020830137600060208583010152509392505050565b6000806040838503121561297a57600080fd5b823567ffffffffffffffff81111561299157600080fd5b8301601f810185136129a257600080fd5b6129b185823560208401612909565b95602094909401359450505050565b6000602082840312156129d257600080fd5b5035919050565b60005b838110156129f45781810151838201526020016129dc565b838111156121645750506000910152565b60008151808452612a1d8160208601602086016129d9565b601f01601f19169290920160200192915050565b6020815260006121766020830184612a05565b600067ffffffffffffffff821115612a5e57612a5e6128c3565b5060209081020190565b600082601f830112612a7957600080fd5b81356020612a8682612a44565b604051612a9382826128dc565b8381529282028501820192828101915086841115612ab057600080fd5b8286015b84811015612acb5780358352918301918301612ab4565b509695505050505050565b600082601f830112612ae757600080fd5b61217683833560208501612909565b600080600080600060a08688031215612b0e57600080fd5b8535612b198161282f565b94506020860135612b298161282f565b9350604086013567ffffffffffffffff80821115612b4657600080fd5b612b5289838a01612a68565b94506060880135915080821115612b6857600080fd5b612b7489838a01612a68565b93506080880135915080821115612b8a57600080fd5b50612b9788828901612ad6565b9150509295509295909350565b60008060408385031215612bb757600080fd5b823567ffffffffffffffff80821115612bcf57600080fd5b818501915085601f830112612be357600080fd5b81356020612bf082612a44565b604051612bfd82826128dc565b8381529282028501820192828101915089841115612c1a57600080fd5b948201945b83861015612c41578535612c328161282f565b82529482019490820190612c1f565b96505086013592505080821115612c5757600080fd5b50612c6485828601612a68565b9150509250929050565b600081518084526020808501945080840160005b83811015612c9e57815187529582019590820190600101612c82565b509495945050505050565b6020815260006121766020830184612c6e565b60008060408385031215612ccf57600080fd5b50508035926020909101359150565b600080600060608486031215612cf357600080fd5b833560038110612d0257600080fd5b9250602084013560ff81168114612d1857600080fd5b929592945050506040919091013590565b60008060408385031215612d3c57600080fd5b8235612d478161282f565b915060208301358015158114612d5c57600080fd5b809150509250929050565b60e060020a634e487b7102600052602160045260246000fd5b600381106128445760e060020a634e487b7102600052602160045260246000fd5b60e08101612dae89612d80565b88825260ff88166020830152866040830152856060830152612dcf85612d80565b8460808301528360a08301528260c083015298975050505050505050565b60008060408385031215612e0057600080fd5b8235612e0b8161282f565b91506020830135612d5c8161282f565b600080600080600060a08688031215612e3357600080fd5b8535612e3e8161282f565b94506020860135612e4e8161282f565b93506040860135925060608601359150608086013567ffffffffffffffff811115612e7857600080fd5b612b9788828901612ad6565b600281046001821680612e9857607f821691505b6020821081036114135760e060020a634e487b7102600052602260045260246000fd5b600084516020612ece8285838a016129d9565b855191840191612ee18184848a016129d9565b8554920191600090612ef281612e84565b60018281168015612f0a5760018114612f1b57612f47565b60ff19841687528287019450612f47565b896000528560002060005b84811015612f3f57815489820152908301908701612f26565b505082870194505b50929a9950505050505050505050565b604081526000808454612f6981612e84565b8060408601526060600180841660008114612f8b5760018114612f9f57612fd0565b60ff19851688840152608088019550612fd0565b8960005260208060002060005b86811015612fc75781548b8201870152908401908201612fac565b8a018501975050505b50505050506020929092019290925292915050565b60e060020a634e487b7102600052601160045260246000fd5b60008282101561301057613010612fe5565b500390565b60208082526021908201527f4f776e6572207061796d656e74207472616e73616374696f6e206661696c656460408201527f2100000000000000000000000000000000000000000000000000000000000000606082015260800190565b60e060020a634e487b7102600052603260045260246000fd5b60006001820161309d5761309d612fe5565b5060010190565b600082198211156130b7576130b7612fe5565b500190565b60e060020a634e487b7102600052601260045260246000fd5b6000826130e4576130e46130bc565b500490565b6000826130f8576130f86130bc565b500690565b60208082526025908201527f455243313135353a207472616e7366657220746f20746865207a65726f20616460408201527f6472657373000000000000000000000000000000000000000000000000000000606082015260800190565b6020808252602a908201527f455243313135353a20696e73756666696369656e742062616c616e636520666f60408201527f72207472616e7366657200000000000000000000000000000000000000000000606082015260800190565b6040815260006131ca6040830185612c6e565b82810360208401526131dc8185612c6e565b95945050505050565b60008160001904831182151516156131ff576131ff612fe5565b500290565b6000600160a060020a03808816835280871660208401525060a0604083015261323060a0830186612c6e565b82810360608401526132428186612c6e565b905082810360808401526132568185612a05565b98975050505050505050565b60006020828403121561327457600080fd5b815161217681612873565b600060033d11156132b55760046000803e7c01000000000000000000000000000000000000000000000000000000006000510490505b90565b600060443d10156132c65790565b6040516003193d81016004833e81513d67ffffffffffffffff81602484011181841117156132f657505050505090565b828501915081518181111561330e5750505050505090565b843d87010160208285010111156133285750505050505090565b613337602082860101876128dc565b509095945050505050565b60208082526028908201527f455243313135353a204552433131353552656365697665722072656a6563746560408201527f6420746f6b656e73000000000000000000000000000000000000000000000000606082015260800190565b6000600160a060020a03808816835280871660208401525084604083015283606083015260a060808301526133d760a0830184612a05565b97965050505050505056fea2646970667358221220e9e184a45ea7548d84adc421ac97c8c9fca54b43d3a6ed06059a35fadfce458264736f6c634300080e0033